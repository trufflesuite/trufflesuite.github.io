<!DOCTYPE html>
<html>
<head>
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-WHT4PS2');</script>
  <!-- End Google Tag Manager -->  
  <meta charset="utf-8">
  <meta name="description" content="The Truffle suite of tools make dapp development easier and more consistent.">
  
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    
  <!-- Favicon -->
  <link rel="icon" href="/img/favicons/favicon.ico">

  <!-- Add to homescreen for Chrome on Android -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="application-name" content="Truffle Suite">
  <link rel="icon" sizes="192x192" href="/img/favicons/chrome-touch-icon-192x192.png">

  <!-- Add to homescreen for Safari on iOS -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="Truffle Suite">
  <link rel="apple-touch-icon" href="/img/favicons/apple-touch-icon.png">

  <!-- Tile icon for Win8/10 (144x144 + tile color) -->
  <meta name="msapplication-TileImage" content="img/favicons/ms-touch-icon-144x144-precomposed.png">
  <meta name="msapplication-TileColor" content="#3372DF">

  <!-- Facebook OpenGraph -->
  <meta property="og:site_name" content="Truffle Suite" />
  <meta property="og:description" content="The Truffle suite of tools make dapp development easier and more consistent." />
  <meta property="og:title" content="Using Truffle to interact with Chainlink Smart Contracts | Blog | Truffle Suite" />
  <meta property="og:url" content="https://trufflesuite.com/blog/using-truffle-to-interact-with-chainlink-smart-contrac" />
  <meta property="og:type" content="article" />
  <meta property="og:image" content="https://truffleframework.com/img/favicons/truffle-share.png" />

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="Truffle Suite" />
  <meta name="twitter:title" content="Using Truffle to interact with Chainlink Smart Contracts | Blog | Truffle Suite" />
  <meta name="twitter:description" content="The Truffle suite of tools make dapp development easier and more consistent." />
  <meta name="twitter:creator" content="Truffle Suite" />
  <meta name="twitter:domain" content="trufflesuite.com" />
  <meta name="twitter:image:src" content="https://truffleframework.com/img/favicons/truffle-share.png" />
  
  <meta name="google-site-verification" content="BSgPkMHzw7IxJTpEElNfD8ZZYPzXgOQiTVPzAxAG8-o" />
    
  <title>Using Truffle to interact with Chainlink Smart Contracts | Blog | Truffle Suite</title>

  <link href="https://fonts.googleapis.com/css?family=Grand+Hotel|Open+Sans|Oswald|Varela+Round|Roboto+Condensed|Roboto+Mono" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.9/css/all.css" integrity="sha384-5SOiIsAziJl6AWe0HWRKTXlfcSHKmYV4RBF18PPJ173Kzn7jzMyFuTtk8JA7QQG1" crossorigin="anonymous">
  <link rel="stylesheet" href="/css/index.css">
</head>
<body>
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WHT4PS2"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->  
  <nav class="navbar navbar-expand-md navbar-dark fixed-top" id="primaryNav">
    <a class="navbar-brand current" href="/">
      <img class="suite-logo" src="/img/truffle-logomark.svg" alt="Truffle Logo" />TRUFFLE SUITE
    </a>
  
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
  
    <div class="collapse navbar-collapse" id="navbarsExampleDefault">
      <ul class="navbar-nav ml-auto">
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" id="suiteDropdown" href="#" data-toggle="dropdown">SUITE</a>
  
          <div class="dropdown-menu">
            <a class="text-truffle" href="/teams">
              <img class="suite-logo" src="/img/tt-logomark.svg" alt="Truffle Teams Logo" /><span class="narrow">T</span>RUFFLE TEAMS
            </a>
            <a class="text-truffle" href="/truffle">
              <img class="suite-logo" src="/img/truffle-logomark.svg" alt="Truffle Logo" /><span class="narrow">T</span>RUFFLE
            </a>
            <a class="text-ganache" href="/ganache">
              <img class="suite-logo" src="/img/ganache-logomark.svg" alt="Ganache Logo" />Ganache
            </a>
            <a class="text-drizzle" href="/drizzle">
              <img class="suite-logo" src="/img/drizzle-logomark.svg" alt="Drizzle Logo" />dri<span class="drizzle-z-skew-1">z</span><span class="drizzle-z-skew-2">z</span>le
            </a>
          </div>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/docs">DOCS</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/tutorials">TUTORIALS</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/boxes">BOXES</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/blog">BLOG</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/events">EVENTS</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/community">COMMUNITY</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/university">UNIVERSITY</a>
        </li>
        <li class="nav-item">
          <a class="nav-link trufflecon-link" href="/trufflecon2019">TRUFFLEC<img src="/img/truffle-logomark.svg">N</a>
        </li>
      </ul>
    </div>
  </nav>
  <main class="container container-heading container-narrow">
    <div class="row">
      <div class="col">
        <h1>Using Truffle to interact with Chainlink Smart Contracts</h1>
        <ul class="list-sm-stacker space-icon mb-0">
          <li><i class="far fa-calendar-alt"></i> 2019-8-20&nbsp;&nbsp;&nbsp;</li>
          <li><i class="far fa-user"></i> Chainlink, Guest Blogger</li>
        </ul>
      </div>
    </div>
  </main>

  <main class="banner banner-light-cream pt-5 pb-5" role="main">
    <div class="container container-post">
      <div class="row justify-content-center">
        <div class="col">
          <p>Chainlink is one of the leading blockchain projects building the very first decentralized oracle network that provides external data to smart contracts. Truffle helps smart contract developers by providing a powerful framework to create, test, and deploy smart contracts. In Chainlink’s blog <a href="https://blog.chain.link/how-to-use-chainlink-with-truffle-2/">post</a>, their <a href="https://github.com/smartcontractkit/chainlink/tree/master/evm/box">Chainlink Truffle Box</a> has gotten some significant upgrades! If you were fortunate enough to attend Trufflecon 2019, then you have already seen these improvements in action, thanks to Chainlink’s presentation by Thomas Hodges. To start developing your very own Chainlink smart contracts, you can grab Chainlink’s Truffle Box by following the guide <a href="https://blog.chain.link/how-to-use-chainlink-with-truffle-2/">here</a>.</p>
<p>This article will showcase these brand new additions, starting with <a href="https://www.trufflesuite.com/docs/truffle/getting-started/writing-external-scripts">Truffle Scripts</a>. Scripts create a much easier approach to interact with our contracts, allowing us to fund a contract with LINK, request data from it, and read the contract’s data with only three commands. To demonstrate this functionality, we will first need to set up our environment variables: MNEMONIC and RPC_URL.</p>
<p>Working with blockchain technology requires a wallet, with one of the most popular choices being <a href="https://metamask.io/">MetaMask</a>. Within minutes, you can have your very own Ethereum wallet that allows you to easily interact with various dApps. During account generation, you will be shown your <strong><em>secret</em></strong> 12-word seed phrase, known as your mnemonic. (Do not share this with anyone; if someone knows your <em>mnemonic</em> they WILL have access to your addresses and private keys). Be sure to store this mnemonic somewhere safe, as you will need it later to work with our example.</p>
<p>Furthermore, you will also need to fund your MetaMask wallet with <a href="https://ropsten.chain.link/">test LINK</a> and <a href="https://faucet.ropsten.be/">test ETH</a>, in order to power transactions on the Ropsten Ethereum Testnet.</p>
<p><em>Note: When funding your account from a test faucet, make sure you switch from the default Main Ethereum Network to the Ropsten Test Network, to properly see your funds. You can follow any transactions made on the Ropsten Testnet via Etherscan.</em></p>
<p>Our second environment variable will require an RPC URL. Some popular RPC connectivity services include <a href="https://www.trufflesuite.com/tutorials/using-infura-custom-provider">Infura</a>, <a href="https://www.linkpool.io/">LinkPool</a>, and <a href="https://fiews.io/free-rpc">Fiews</a>. After establishing a valid RPC connection and the funded address, you can start deploying smart contracts to public networks.</p>
<figure>
  <img src="/img/blog/using-truffle-to-interact-with-chainlink-smart-contracts/01.png" alt="Truffle DB data model" style="width:100%">
  <figcaption><em>Shown above are the environment variables needed to link your MetaMask wallet to Truffle, found in truffle-config.js.</em></figcaption>
</figure>

<p>Once you have all the data you need, you can set your environment variables via the terminal commands:</p>
<pre><code class="lang-shell">export RPC_URL=your_url_here
export MNEMONIC=’your 12 words here’
</code></pre>

    <h2 class="link-markdown">
      <a href="#migration" name="migration"><i class="fas fa-link"></i></a>
      Migration
    </h2>
  <p>We are now ready to deploy our smart contract on a public network. To begin, run the command:</p>
<pre><code class="lang-shell">npm run migrate:live
</code></pre>
<p>This will compile all of your smart contracts, and then start deploying (migrating) them.</p>
<p><em>Note: you may encounter some compilation warnings with the Chainlink contracts. This is simply because the LINK token was originally deployed with an older version of Solidity. Given that this contract is only being deployed when you run tests, these can be ignored.</em></p>
<figure>
  <img src="/img/blog/using-truffle-to-interact-with-chainlink-smart-contracts/02.png" alt="Truffle DB data model" style="width:100%">
  <figcaption><em>Console output of one of our contracts deploying. This particular transaction can be found <a href="https://ropsten.etherscan.io/tx/0x4c8125f0e074ce3f65b08f67f9685a0d00c2985c6ebd372507016d78c344d25b">here</a>.</em></figcaption>
</figure>

<p>Deploying our <code>Migrations</code> and <code>MyContract</code> cost us Ethereum, hence why we needed the faucet from earlier. Now that our contract is deployed, we can utilize the three helper scripts to fund <code>MyContract</code> with LINK (which we got from the Chainlink faucet), create requests, and read the state.</p>
<p>There are 3 helper scripts provided to interact with our contract, located in the scripts directory:</p>
<ul>
<li><code>fund-contract.js</code></li>
<li><code>request-data.js</code></li>
<li><code>read-contract.js</code></li>
</ul>
<p>They can be used by calling them from <code>npx truffle exec</code>. First, we must fund our contract with LINK, which can be done by running the following command:</p>
<pre><code class="lang-shell">npx truffle exec scripts/fund-contract.js --network live
</code></pre>
<figure>
  <img src="/img/blog/using-truffle-to-interact-with-chainlink-smart-contracts/03.png" alt="Truffle DB data model" style="width:100%">
</figure>

<p>Following deployment, the output displays our contract address as well as the transaction address. We can also look this up on the ropsten <a href="https://ropsten.etherscan.io/tx/0x39e48b6d8170060affdb57baf8b794424f83296aa9e105163113fea08d300504">explorer</a>.</p>
<figure>
  <img src="/img/blog/using-truffle-to-interact-with-chainlink-smart-contracts/04.png" alt="Truffle DB data model" style="width:100%">
</figure>

<p>Notice that upon completion, a payment of 1 LINK was sent during the transaction, clearly indicating that our contract has properly been funded. Next, we can now <code>request data</code> from the contract by running:</p>
<pre><code class="lang-shell">npx truffle exec scripts/request-data.js --network live
</code></pre>
<figure>
  <img src="/img/blog/using-truffle-to-interact-with-chainlink-smart-contracts/05.png" alt="Truffle DB data model" style="width:100%">
  <figcaption><em>In the Chainlink explorer for the network that you made the request (in our example we use Ropsten, but it would work similarly for Rinkeby, Kovan, and Mainnet). As you can see the Chainlink node that we were requesting data from picked up our request and waited for 3 block confirmations before executing the job. We are now ready to read the contract’s state with the written answer from the Chainlink node, indicated by the fulfillment transaction (highlighted in red).</em></figcaption>
</figure>

<p>And finally, for reading the data we run our read-contract script. In particular, this will run faster because we’re not creating a transaction, we are simply reading the current state of the smart contract.</p>
<pre><code class="lang-shell">npx truffle exec scripts/read-contract.js --network live
</code></pre>
<figure>
  <img src="/img/blog/using-truffle-to-interact-with-chainlink-smart-contracts/06.png" alt="Truffle DB data model">
</figure>

<p>Notice for our output when reading the data, we get a number displaying the current price of LINK in USD * 100 (as of writing, 22094). This is due to the value of times specified in our smart contract request-data.js.</p>
<figure>
  <img src="/img/blog/using-truffle-to-interact-with-chainlink-smart-contracts/07.png" alt="Truffle DB data model" style="width:100%">
  <figcaption>_Request-data.js. TRUFFLE_CL_BOX_TIMES is an environment variable which is used to override the default value of 100. This value is used for the precision of the endpoint’s response (in this case, for the price of ETH in USD), and also because Solidity cannot handle decimals. Any of these values can be changed for your project._</figcaption>
</figure>

<p>Thanks to the power of Truffle, it has never been easier to work with smart contract development. We hope you enjoyed working with our Chainlink Truffle Box, allowing you to fully test, deploy, and interact with contracts on the network. Thanks for reading, and stay tuned for future updates at <a href="https://blog.chain.link/">https://blog.chain.link/</a>.</p>


          <div class="contribute-link">
            See a way to make this page better? <a href="https://github.com/trufflesuite/trufflesuite.com/edit/master/src/blog">Edit here &raquo;</a>
          </div>        </div>
      </div>
    </div>
  </main>

  <footer>
    <div class="container">
      <div class="row">
        <div class="col-12 col-md-2 mb-4 mb-md-0">
          <img class="truffle-logo" src="/img/truffle-logo-light.svg" alt="Truffle Logo" />
        </div>
  
        <div class="col-12 col-md-5 mb-3 mb-md-0">
          <ul>
            <li><a href="mailto:inquiry@trufflesuite.com">CONTACT US</a></li>
            <li><a href="/policy">PRIVACY POLICY</a></li>
            <li><a href="/press-releases">PRESS RELEASES</a></li>
            <li><a href="/staff">STAFF</a></li>
            <li><a href="/dashboard">DASHBOARD</a></li>
            <li><a href="https://github.com/trufflesuite">GITHUB</a></li>
            <li><a class="trufflecon-link" href="/trufflecon2019">TRUFFLEC<img src="/img/truffle-logomark.svg" alt="Truffle Logo" /><span>O</span>N 2019</a></li>
            <li><strong>&copy; Truffle Blockchain Group 2019</strong></li>
          </ul>
  
          <ul class="list-inline h4 ">
            <li class="list-inline-item mb-0"><a href="https://www.reddit.com/r/truffle"><i class="fab fa-reddit-square"></i></a></li>
            <li class="list-inline-item mb-0"><a href="https://twitter.com/trufflesuite"><i class="fab fa-twitter-square"></i></a></li>
            <li class="list-inline-item mb-0"><a href="https://www.facebook.com/trufflesuite/"><i class="fab fa-facebook-square"></i></a></li>
            <li class="list-inline-item mb-0"><a href="https://www.instagram.com/truffledevsuite/"><i class="fab fa-instagram"></i></a></li>
            <li class="list-inline-item mb-0"><a href="https://www.linkedin.com/company/trufflesuite/"><i class="fab fa-linkedin"></i></a></li>
            <li class="list-inline-item mb-0"><a href="https://www.youtube.com/channel/UCo2cy2Z7_91zPJSrb6NWfSw"><i class="fab fa-youtube-square"></i></a></li>
          </ul>
        </div>
  
        <div class="col-12 col-md-5">
          <h4>SIGN UP FOR THE TRUFFLE MAILING LIST</h4>
            <form action="https://truffleframework.us11.list-manage.com/subscribe/post?u=947c9b18fc27e0b00fc2ad055&amp;id=97cfd4251b" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" target="_blank" novalidate>
              <div class="form-group">
                <input type="email" name="EMAIL" class="form-control" placeholder="Email Address" id="footerMailingEmail" required>
              </div>
              <div class="form-group">
                <input type="text" name="FNAME" class="form-control" placeholder="First Name" id="footerMailingFirstName">
                <small id="firstNameHelp" class="form-text text-muted">So we know how to address you.</small>
              </div>
              <button type="submit" class="btn btn-truffle">SUBSCRIBE</button>
            </form>
        </div>
      </div>
    </div>
  </footer>
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
  <script>window.jQuery || document.write('<script src="/js/vendor/jquery-3.2.1.slim.min.js"><\/script>')</script>
  <script src="/js/bootstrap.min.js"></script>
  <script src="/js/vendor/prism.js"></script>
  <script src="/js/markdown-cleanup.js"></script>
</body>
</html>